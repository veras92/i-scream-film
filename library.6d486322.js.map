{"mappings":"oeAAAA,EAAA,SCAA,IAAAC,EAAAD,EAAA,S,8EASAE,OAAOC,iBAAiB,QAAQ,KAC9BC,EAAAC,KAAKC,KAAKC,UACR,iGAAiG,IAGrG,MAAMC,EAAeC,SAASC,cAAc,sBACtCC,EAAaF,SAASC,cAAc,oBAW1CE,eAAeC,EAAaC,EAAQC,GAClC,KACE,EAAAC,EAAAC,cACA,MAAMC,GAAW,EAAAjB,EAAAkB,aAAYC,EAAAC,KACvBC,GAAY,EAAArB,EAAAsB,KAAIL,EAAU,GAAGJ,KAAUC,KAEvCS,SADuB,EAAAvB,EAAAwB,KAAIH,IACHI,MAe9B,GAbe,YAAXX,IACGS,IACHpB,EAAAC,KAAKC,KAAKC,UACR,gHAGS,UAAXQ,IACGS,IACHpB,EAAAC,KAAKC,KAAKC,UACR,0GAIFiB,EAAQ,CACV,MAAMG,EAAcC,OAAOC,OAAOL,GAIlC,OAaNZ,eAAwBkB,GACtB,MAAMC,EAAW,IAAI,EAAAC,EAAAC,UACfC,QAAiBC,QAAQC,IAC7BN,EAAYO,KAAIC,GAAMP,EAASQ,YAAYD,OAQ/C,SAAsBE,GACpBpC,EAAAC,KAAKC,KAAKC,UAAYiC,C,CAJtBC,EADe,EAAAC,EAAAC,qBAAoBT,G,CAtBtBU,CAAAjB,GAEFA,C,CAIP,MAAO,E,CAET,MAAOkB,GACPC,QAAQD,MAAMA,E,CACf,SACC,EAAA7B,EAAA+B,a,EAmBJ,SAASC,EAAUjC,IACJ,EAAAkC,EAAAC,WAERC,oBAAmBC,IACtB,GAAIA,EAAM,CAERvC,EADeuC,EAAKC,IACCtC,E,KArE3BP,EAAaL,iBAAiB,SAG9B,WACE6C,EAAU,U,IAHZrC,EAAWR,iBAAiB,SAK5B,WACE6C,EAAU,Q","sources":["src/library.js","src/js/test-library.js"],"sourcesContent":["import './js/refs';\r\nimport './js/test-library';\r\nimport './js/team_modal';\r\nimport './js/library-modal';\r\nimport './js/up-btn';\r\nimport './js/cards-library';\r\nimport './js/film-service';\r\nimport './js/loader';\r\nimport './js/firebase';\r\nimport './js/heart-animation';\r\nimport './js/firebase-config';\r\nimport './js/modal-window';\r\n","import { getDatabase, ref, get } from 'firebase/database';\r\nimport { getAuth } from 'firebase/auth';\r\n\r\nimport { FimlsApi } from './film-service';\r\nimport { createHomepageCards } from './cards-library';\r\nimport { refs } from './refs';\r\nimport { showLoader, hideLoader } from './loader';\r\nimport { app } from './firebase-config';\r\n\r\nwindow.addEventListener('load', () => {\r\n  refs.list.innerHTML =\r\n    '<li class=\"library-title-item\"><h2 class=\"library-title-main\">Welcome to your library</h2></li>';\r\n});\r\n\r\nconst btnWatchedEl = document.querySelector('.js-watched-button');\r\nconst btnQueueEl = document.querySelector('.js-queue-button');\r\n\r\nbtnWatchedEl.addEventListener('click', onClickWatchedBtn);\r\nbtnQueueEl.addEventListener('click', onClickQueueBtn);\r\n\r\nfunction onClickWatchedBtn() {\r\n  getUserId('watched');\r\n}\r\nfunction onClickQueueBtn() {\r\n  getUserId('queue');\r\n}\r\nasync function getDataArray(userId, action) {\r\n  try {\r\n    showLoader();\r\n    const database = getDatabase(app);\r\n    const moviesRef = ref(database, `${userId}/${action}`);\r\n    const moviesSnapshot = await get(moviesRef);\r\n    const movies = moviesSnapshot.val();\r\n\r\n    if (action === 'watched') {\r\n      if (!movies) {\r\n        refs.list.innerHTML =\r\n          '<li class=\"library-title-item\"><h2 class=\"library-title-main\">You have nothing on your watch list</h2></li>';\r\n      }\r\n    }\r\n    if (action === 'queue') {\r\n      if (!movies) {\r\n        refs.list.innerHTML =\r\n          '<li class=\"library-title-item\"><h2 class=\"library-title-main\">There is nothing in the queue</h2></li>';\r\n      }\r\n    }\r\n\r\n    if (movies) {\r\n      const moviesArray = Object.values(movies);\r\n      //тут масив з id\r\n      getFilms(moviesArray);\r\n\r\n      return moviesArray;\r\n    } else {\r\n      // якщо фільмі немає, очищає сторінку\r\n      // refs.list.innerHTML = '';\r\n      return [];\r\n    }\r\n  } catch (error) {\r\n    console.error(error);\r\n  } finally {\r\n    hideLoader();\r\n  }\r\n}\r\n\r\nasync function getFilms(filmsIdsArr) {\r\n  const filmsApi = new FimlsApi();\r\n  const filmsArr = await Promise.all(\r\n    filmsIdsArr.map(id => filmsApi.getFilmById(id))\r\n  );\r\n\r\n  // filmsArr масив з інфою про фільми\r\n  const markup = createHomepageCards(filmsArr);\r\n  renderMarkup(markup);\r\n}\r\n\r\nfunction renderMarkup(markup) {\r\n  refs.list.innerHTML = markup;\r\n}\r\n\r\nfunction getUserId(action) {\r\n  const auth = getAuth();\r\n\r\n  auth.onAuthStateChanged(user => {\r\n    if (user) {\r\n      const userId = user.uid;\r\n      getDataArray(userId, action);\r\n    }\r\n  });\r\n}\r\n"],"names":["parcelRequire","$jAzyG","window","addEventListener","$krGWQ","refs","list","innerHTML","$67e7180826cb6a14$var$btnWatchedEl","document","querySelector","$67e7180826cb6a14$var$btnQueueEl","async","$67e7180826cb6a14$var$getDataArray","userId","action","$gjiCh","showLoader","database","getDatabase","$7iEdO","app","moviesRef","ref","movies","get","val","moviesArray","Object","values","filmsIdsArr","filmsApi","$6meQU","FimlsApi","filmsArr","Promise","all","map","id","getFilmById","markup","$67e7180826cb6a14$var$renderMarkup","$cjo0G","createHomepageCards","$67e7180826cb6a14$var$getFilms","error","console","hideLoader","$67e7180826cb6a14$var$getUserId","$eyjy7","getAuth","onAuthStateChanged","user","uid"],"version":3,"file":"library.6d486322.js.map"}
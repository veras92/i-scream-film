{"mappings":"iiBAAAA,EAAA,SCAA,IAAAC,EAAAD,EAAA,S,wGAmBME,EAAMC,EAAAC,QAASC,cAXE,CACrBC,OAAQ,0CACRC,WAAY,kCACZC,UAAW,kBACXC,cAAe,8BACfC,kBAAmB,eACnBC,MAAO,4CAEPC,YAAa,wDAKTC,EAAeC,SAASC,cAAc,sBACtCC,EAAaF,SAASC,cAAc,oB,SAY3BE,I,OAAAA,EAAfC,EAAAjB,EAAA,CAAAiB,EAAAC,GAAAC,MAAA,SAAAC,EAA4BC,EAAQC,G,IAG1BC,EACAC,EACAC,EACAC,EAgBEC,E,mFApBR,EAAAC,EAAAC,cACMN,GAAW,EAAAO,EAAAC,aAAY9B,GACvBuB,GAAY,EAAAM,EAAAE,KAAIT,EAAU,GAAaU,OAAVZ,EAAO,KAAUY,OAAPX,I,UAChB,EAAAQ,EAAAI,KAAIV,G,UAA3BC,EAAcU,EAAAC,KACdV,EAASD,EAAeY,MAEf,YAAXf,IACGI,IACHY,EAAAC,KAAKC,KAAKC,UACR,qFAGS,UAAXnB,IACGI,IACHY,EAAAC,KAAKC,KAAKC,UACR,gFAIFf,EAAM,C,uBAGCgB,EAFHf,EAAcgB,OAAOC,OAAOlB,I,kBAI3BC,G,iCAIA,I,0DAGTkB,QAAQC,MAAKX,EAAAY,I,0BAEb,EAAAnB,EAAAoB,c,8EAnCuBC,MAAAC,KAAAC,U,UAuCZT,EAASU,G,OAATC,EAAQJ,MAAAC,KAAAC,U,UAARE,I,OAAAA,EAAfpC,EAAAjB,EAAA,CAAAiB,EAAAC,GAAAC,MAAA,SAAAC,EAAwBgC,G,IAChBE,EACAC,E,yEADAD,EAAW,IAAI,EAAAE,EAAAC,U,SACEC,QAAQC,IAC7BP,EAAYQ,KAAI,SAAAC,G,OAAMP,EAASQ,YAAYD,E,YADvCN,EAAQpB,EAAAC,KAMd2B,GADe,EAAAC,EAAAC,qBAAoBV,I,4CAPdN,MAAAC,KAAAC,U,CAWvB,SAASY,EAAaG,GACpB5B,EAAAC,KAAKC,KAAKC,UAAYyB,C,CAGxB,SAASC,EAAU7C,IACJ,EAAA8C,EAAAC,WAERC,oBAAmB,SAAAC,GAClBA,G,SA1DoBlD,EAAQC,GAArBN,EAAYiC,MAAAC,KAAAC,U,CA4DrBqB,CADeD,EAAKE,IACCnD,E,IAtE3BV,EAAa8D,iBAAiB,SAI9B,WACEP,EAAU,U,IAJZpD,EAAW2D,iBAAiB,SAM5B,WACEP,EAAU,Q","sources":["src/library.js","src/js/test-library.js"],"sourcesContent":["import './js/refs';\r\nimport './js/test-library';\r\nimport './js/team_modal';\r\nimport './js/library-modal';\r\nimport './js/up-btn';\r\nimport './js/cards-library';\r\nimport './js/film-service';\r\nimport './js/loader';\r\nimport './js/firebase';\r\nimport './js/heart-animation';\r\nimport './js/firebase-config';\r\n","import { getDatabase, ref, get } from 'firebase/database';\r\nimport { getAuth } from 'firebase/auth';\r\nimport firebase from 'firebase/compat/app';\r\nimport { FimlsApi } from './film-service';\r\nimport { createHomepageCards } from './cards-library';\r\nimport { refs } from './refs';\r\nimport { showLoader, hideLoader } from './loader';\r\n\r\nconst firebaseConfig = {\r\n  apiKey: 'AIzaSyA8HI-hGo7_WkrdYi4nAbp8aOc6TTRuWvY',\r\n  authDomain: 'filmoteka-c3101.firebaseapp.com',\r\n  projectId: 'filmoteka-c3101',\r\n  storageBucket: 'filmoteka-c3101.appspot.com',\r\n  messagingSenderId: '990735444623',\r\n  appId: '1:990735444623:web:5585f899cc012270841efa',\r\n\r\n  databaseURL: 'https://filmoteka-c3101-default-rtdb.firebaseio.com',\r\n};\r\n\r\nconst app = firebase.initializeApp(firebaseConfig);\r\n\r\nconst btnWatchedEl = document.querySelector('.js-watched-button');\r\nconst btnQueueEl = document.querySelector('.js-queue-button');\r\n\r\nbtnWatchedEl.addEventListener('click', onClickWatchedBtn);\r\nbtnQueueEl.addEventListener('click', onClickQueueBtn);\r\n// window.addEventListener('')\r\n\r\nfunction onClickWatchedBtn() {\r\n  getUserId('watched');\r\n}\r\nfunction onClickQueueBtn() {\r\n  getUserId('queue');\r\n}\r\nasync function getDataArray(userId, action) {\r\n  try {\r\n    showLoader();\r\n    const database = getDatabase(app);\r\n    const moviesRef = ref(database, `${userId}/${action}`);\r\n    const moviesSnapshot = await get(moviesRef);\r\n    const movies = moviesSnapshot.val();\r\n\r\n    if (action === 'watched') {\r\n      if (!movies) {\r\n        refs.list.innerHTML =\r\n          '<li><h2 class=\"library-title-main\">You have nothing on your watch list</h2></li>';\r\n      }\r\n    }\r\n    if (action === 'queue') {\r\n      if (!movies) {\r\n        refs.list.innerHTML =\r\n          '<li><h2 class=\"library-title-main\">There is nothing in the queue</h2></li>';\r\n      }\r\n    }\r\n\r\n    if (movies) {\r\n      const moviesArray = Object.values(movies);\r\n      //тут масив з id\r\n      getFilms(moviesArray);\r\n\r\n      return moviesArray;\r\n    } else {\r\n      // якщо фільмі немає, очищає сторінку\r\n      // refs.list.innerHTML = '';\r\n      return [];\r\n    }\r\n  } catch (error) {\r\n    console.error(error);\r\n  } finally {\r\n    hideLoader();\r\n  }\r\n}\r\n\r\nasync function getFilms(filmsIdsArr) {\r\n  const filmsApi = new FimlsApi();\r\n  const filmsArr = await Promise.all(\r\n    filmsIdsArr.map(id => filmsApi.getFilmById(id))\r\n  );\r\n\r\n  // filmsArr масив з інфою про фільми\r\n  const markup = createHomepageCards(filmsArr);\r\n  renderMarkup(markup);\r\n}\r\n\r\nfunction renderMarkup(markup) {\r\n  refs.list.innerHTML = markup;\r\n}\r\n\r\nfunction getUserId(action) {\r\n  const auth = getAuth();\r\n\r\n  auth.onAuthStateChanged(user => {\r\n    if (user) {\r\n      const userId = user.uid;\r\n      getDataArray(userId, action);\r\n    }\r\n  });\r\n}\r\n"],"names":["parcelRequire","$bpxeT","$db18a69391d6e534$var$app","$9QmSZ","default","initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","databaseURL","$db18a69391d6e534$var$btnWatchedEl","document","querySelector","$db18a69391d6e534$var$btnQueueEl","$db18a69391d6e534$var$_getDataArray","$parcel$interopDefault","$2TvXO","mark","_callee","userId","action","database","moviesRef","moviesSnapshot","movies","moviesArray","$kvC6y","showLoader","$cokon","getDatabase","ref","concat","get","_ctx","sent","val","$4Nugj","refs","list","innerHTML","$db18a69391d6e534$var$getFilms","Object","values","console","error","t0","hideLoader","apply","this","arguments","filmsIdsArr","$db18a69391d6e534$var$_getFilms","filmsApi","filmsArr","$9Vqzl","FimlsApi","Promise","all","map","id","getFilmById","$db18a69391d6e534$var$renderMarkup","$flcv8","createHomepageCards","markup","$db18a69391d6e534$var$getUserId","$gQOBw","getAuth","onAuthStateChanged","user","$db18a69391d6e534$var$getDataArray","uid","addEventListener"],"version":3,"file":"library.1540456c.js.map"}